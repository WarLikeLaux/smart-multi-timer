# –ü–õ–ê–ù –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê ‚Äî –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É

**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ
**–¶–µ–ª—å:** –ü—Ä–∏–≤–µ—Å—Ç–∏ –≤–µ—Å—å –∫–æ–¥ –∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º contract.md (KISS > YAGNI > DRY)

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### –ú–æ–¥—É–ª—å CalorieStorage (commit 1b7073a)
- ‚úÖ –°–æ–∑–¥–∞–Ω `src/tabs/calorie_storage.py` (318 —Å—Ç—Ä–æ–∫)
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã guard clauses
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å (‚â§2 —É—Ä–æ–≤–Ω—è)
- ‚úÖ –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤: `_calculate_multiplier`, `_update_entry_nutrients`, `_calculate_macros`
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- ‚úÖ –§–∞–π–ª –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ–ø—É—Å–∫–∞ (‚â§350 —Å—Ç—Ä–æ–∫)

---

## üîÑ –í –†–ê–ë–û–¢–ï

### CalorieTrackerTab ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** 1198 —Å—Ç—Ä–æ–∫ (–ø–æ—Ç–æ–ª–æ–∫ 500, –¥–æ–ø—É—Å–∫ 350, —Ü–µ–ª—å 200)
**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –í—ã–Ω–µ—Å—Ç–∏ ~700 —Å—Ç—Ä–æ–∫

#### –î–∏–∞–ª–æ–≥–∏ –¥–ª—è –≤—ã–Ω–æ—Å–∞ –≤ `calorie_dialogs.py`:

1. **`_show_add_product_to_db_dialog`** (~150 —Å—Ç—Ä–æ–∫, —Å—Ç—Ä–æ–∫–∞ 287)
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –±–∞–∑–µ
   - ‚Üí –ö–ª–∞—Å—Å `ProductDatabaseDialog`

2. **`_show_add_product_dialog`** (~226 —Å—Ç—Ä–æ–∫, —Å—Ç—Ä–æ–∫–∞ 437)
   - –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
   - ‚Üí –ö–ª–∞—Å—Å `MealProductDialog`

3. **`_show_csv_import_dialog`** (~127 —Å—Ç—Ä–æ–∫, —Å—Ç—Ä–æ–∫–∞ 870)
   - –ú–∞—Å—Å–æ–≤—ã–π CSV –∏–º–ø–æ—Ä—Ç
   - ‚Üí –ö–ª–∞—Å—Å `CSVImportDialog`

4. **`_create_product_from_dialog`** (~200 —Å—Ç—Ä–æ–∫, —Å—Ç—Ä–æ–∫–∞ 998)
   - –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
   - ‚Üí –ö–ª–∞—Å—Å `QuickProductDialog`

**–ò—Ç–æ–≥–æ:** ~703 —Å—Ç—Ä–æ–∫–∏ ‚Üí –ü–æ—Å–ª–µ –≤—ã–Ω–æ—Å–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è ~495 —Å—Ç—Ä–æ–∫ ‚úÖ

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å calorie_dialogs.py
```python
"""
–î–∏–∞–ª–æ–≥–æ–≤—ã–µ –æ–∫–Ω–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–ª–æ—Ä–∏—è–º–∏.

–ö–ª–∞—Å—Å—ã:
- ProductDatabaseDialog: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- MealProductDialog: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –∫ –ø—Ä–∏–µ–º—É –ø–∏—â–∏
- CSVImportDialog: –º–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ CSV
- QuickProductDialog: –±—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
"""
```

### –®–∞–≥ 2: –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
–ö–∞–∂–¥—ã–π –¥–∏–∞–ª–æ–≥ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –º–µ—Ç–æ–¥—ã ‚â§50 —Å—Ç—Ä–æ–∫:
- `__init__`: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `_setup_ui`: —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- `_setup_bindings`: –ø—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
- `_on_save`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- `_validate`: –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 3: –£–ø—Ä–æ—Å—Ç–∏—Ç—å CalorieTrackerTab
–ü–æ—Å–ª–µ –≤—ã–Ω–æ—Å–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –ø—Ä–∏–º–µ–Ω–∏—Ç—å:
- Guard clauses –≤–µ–∑–¥–µ
- –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ >50 —Å—Ç—Ä–æ–∫
- –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

### –®–∞–≥ 4: –ú–µ—Ç–æ–¥—ã CalorieTrackerTab –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è
```
_create_products_panel     ‚Äî 89 —Å—Ç—Ä–æ–∫  ‚Üí —Ä–∞–∑–±–∏—Ç—å –Ω–∞ helpers
_create_meal_section       ‚Äî 59 —Å—Ç—Ä–æ–∫  ‚Üí —Ä–∞–∑–±–∏—Ç—å –Ω–∞ helpers
_update_meal_display       ‚Äî 55 —Å—Ç—Ä–æ–∫  ‚Üí –ø—Ä–∏–º–µ–Ω–∏—Ç—å guard clauses
_update_stats              ‚Äî 37 —Å—Ç—Ä–æ–∫  ‚Üí OK
```

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

- [ ] CalorieTrackerTab ‚â§ 500 —Å—Ç—Ä–æ–∫ (—Ü–µ–ª—å ‚â§350)
- [ ] CalorieDialogs ‚â§ 500 —Å—Ç—Ä–æ–∫
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã ‚â§ 50 —Å—Ç—Ä–æ–∫
- [ ] –í–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å ‚â§ 2 —É—Ä–æ–≤–Ω—è
- [ ] Guard clauses –≤–µ–∑–¥–µ
- [ ] –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- [ ] Type hints –≤–µ–∑–¥–µ

---

## üìä –ü–†–û–ì–†–ï–°–°

| –ú–æ–¥—É–ª—å | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –°—Ç–∞—Ç—É—Å |
|--------|------|-------|--------|
| calorie_tracker_tab.py | 1543 | 1198 | ‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ |
| calorie_storage.py | - | 318 | ‚úÖ OK |
| calorie_dialogs.py | - | TODO | ‚è≥ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** 1/3 –º–æ–¥—É–ª–µ–π –≥–æ—Ç–æ–≤—ã

---

## üîñ –°–°–´–õ–ö–ò

- –ö–æ–Ω—Ç—Ä–∞–∫—Ç: `docs/ai/contract.md`
- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–º–∏—Ç: `1b7073a`
- –ü—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç: `fddf1a0`
